meta
{
    title: "MTB Trailmap - Map Style for JOSM";
    description: "Easily visualize path or trail difficulty, uphill difficulty, trail width, visibility and surface while editing maps with JOSM editor";
    version: 1_2024-07-29;
    author: "Tommi Contursi";
    link: "https://github.com/TommiContursi/MTB-TrailMap-JOSM-Style";
    min-josm-version: 7110;
}

meta[lang=en]
{
    title: "Trailmap Style";
    description: "JOSM Style";
}

/* Basic canvas background color */
canvas
{
    //fill-color: #606060;
}

/* Node styles for different zoom levels */
node
{
    symbol-shape: circle;
    symbol-fill-color: darkgrey;
    symbol-stroke-color: lightgreen;
}
node|z-15
{
    symbol-size: 0.1;
}
node|z16
{
    symbol-size: 2;
}
node|z17
{
    symbol-size: 3;
    symbol-stroke-width: 1;
}
node|z18-
{
    symbol-size: 4;
    symbol-stroke-width: 1;
}
node:connection
{
    symbol-fill-color: yellow;
}

/* Basic highway styles for cycleway, track, and path */
way[highway=~/track|path/]
{
    color: #000;
    width: 3;
    dashes: 7, 5;
    casing-width: 2;
    right-casing-color: #ffffff00;
    left-casing-color: #ffffff00;
    left-casing-width: 4;
    right-casing-width: 4;
    left-casing-offset: 3;
}
way[highway=track]
{
    color: #000;
    dashes: 15, 5;
    right-casing-color: #ffffff00;
    left-casing-color: #ffffff00;
    casing-color: #ffffff00;
    width: 4;
    casing-width: 3;
    left-casing-width: 8;
    right-casing-width: 10;
    left-casing-offset: 4;
}
way[highway=cycleway]
{
    color: #3146d7;
    width: 3;
    dashes: 15, 5;
    casing-width: 1;
    dashes-background-color: #fff;
    casing-color: #fff;
}
way[highway=footway]
{
    color: #a43820;
    width: 4;
    dashes: 5, 5;
}

/* Basic road styles */
way[highway=~/unclassified|residential|tertiary|service/] {
    color: darkgrey;
    opacity: 0.5;
    casing-color: grey;
    casing-width: 2;
}
way|z-14[highway=~/unclassified|residential|tertiary|service/] {
    width: 3;
}
way|z15-16[highway=~/unclassified|residential|tertiary|service/] {
    width: 4;
}
way|z17-[highway=~/unclassified|residential|tertiary|service/] {
    width: 6;
}

way[highway=~/motorway|trunk|primary|secondary/] {
    color: darkgrey;
    opacity: 0.5;
    casing-color: grey;
    casing-width: 2;
}
way|z-14[highway=~/motorway|trunk|primary|secondary/] {
    width: 3;
}
way|z15-16[highway=~/motorway|trunk|primary|secondary/] {
    width: 4;
}
way|z17-[highway=~/motorway|trunk|primary|secondary/] {
    width: 6;
}

/* Waterways */
way[waterway] {
    color: #6CCEE4;
    width: 3;
}

/* Bicycle route relation underlay */
relation[type=route][route=~/bicycle|mtb/][network=ncn] > way::relation_underlay {
    z-index: -200;
    width: 15;
    color: red;
    opacity: 0.15;
    linecap: none;
}
relation[type=route][route=~/bicycle|mtb/][network=rcn] > way::relation_underlay {
    z-index: -200;
    width: 15;
    color: cyan;
    opacity: 0.15;
    linecap: none;
}
relation[type=route][route=~/bicycle|mtb/][network=lcn] > way::relation_underlay {
    z-index: -200;
    width: 15;
    color: blue;
    opacity: 0.15;
    linecap: none;
}

/* Text display for mtb:scale */
setting::mtb_scale_text_display {
default: true;
type: boolean;
label: "Display Difficulty Text";
description: "Toggle display of MTB Difficulty Scale text next to the path";
}

way|z17-[mtb:scale][setting("mtb_scale_text_display")]::mtbscale_layer {
    font-family: Arial;
    text: concat("S", tag("mtb:scale"));
    text-color: eval(
    tag("mtb:scale") == "0-" ? "#50d6eb" :
    tag("mtb:scale") == "0" ? "#75e009" :
    tag("mtb:scale") == "1" ? "#e3e800" :
    tag("mtb:scale") == "2" ? "#feb13e" :
    tag("mtb:scale") == "3" ? "#ff4454" :
    tag("mtb:scale") == "4" ? "#f20bab" :
    tag("mtb:scale") == "5" ? "#bf1cf5" :
    tag("mtb:scale") == "6" ? "#8100ac" : "#ffffff"
    );
    font-size: 14;
    font-weight: bold;
    text-offset: 10;
    text-position: line;
    z-index: 2;
    text-halo-color: black;
    text-halo-radius: 1;
}

/* Text display for mtb:scale:uphill */
way|z17-[mtb:scale][mtb:scale:uphill]::mtbscale_layer_uphill  {
    text: concat("UP S", tag("mtb:scale:uphill"));
    text-color: eval(
    tag("mtb:scale:uphill") == "0" ? "#75e009" :
    tag("mtb:scale:uphill") == "1" ? "#e3e800" :
    tag("mtb:scale:uphill") == "2" ? "#feb13e" :
    tag("mtb:scale:uphill") == "3" ? "#ff4454" :
    tag("mtb:scale:uphill") == "4" ? "#f20bab" :
    tag("mtb:scale:uphill") == "5" ? "#bf1cf5" :  "#ffffff"
    );
    font-size: 14;
    font-weight: bold;
    text-offset: -10;
    text-position: line;
    z-index: 2;
    text-halo-color: black;
    text-halo-radius: 1;
}

/* Optional properties for trails and paths */

/* Width based on track width */
way[highway=~/track|path/][width] {
    width: eval(
        tag("width") < 0.6 ? 2 :
        tag("width") < 0.9 ? 2 :
        tag("width") < 1.8 ? 3 : 4
    );
    casing-width: eval(
        tag("width") < 0.6 ? 1 :
        tag("width") < 0.9 ? 2 :
        tag("width") < 1.8 ? 2 : 3
    );
    left-casing-width: eval(
        tag("width") < 0.6 ? 3 :
        tag("width") < 0.9 ? 4 :
        tag("width") < 1.8 ? 6 : 8
    );
    right-casing-width: eval(
        tag("width") < 0.6 ? 4 :
        tag("width") < 0.9 ? 6 :
        tag("width") < 1.8 ? 8 : 10
    );
    left-casing-offset: eval(
        tag("width") < 0.6 ? 2 :
        tag("width") < 0.9 ? 3 :
        tag("width") < 1.8 ? 4 : 4
    );
}

/* Visibility based styles */
way[trail_visibility=excellent] {
    dashes: 8, 5;
}
way[trail_visibility=good] {
    dashes: 8, 5;
}
way[trail_visibility=intermediate] {
    dashes: 6, 5;
    casing-opacity: 0.75;
    casing-dashes-opacity: 0.75;
}
way[trail_visibility=bad] {
    dashes: 6, 5;
    casing-opacity: 0.5;
    casing-dashes-opacity: 0.5;
}
way[trail_visibility=horrible] {
    dashes: 6, 5;
    casing-opacity: 0.5;
    opacity: 0.5;
}
way[trail_visibility=no] {
    dashes: 6, 5;
    casing-opacity: 0.25;
    casing-dashes-opacity: 0.25;
}

/* Obstacle based styles */
way[obstacle="vegetation"] {
    right-casing-color: #56aa00;
    right-casing-dashes: 3, 7;
    right-casing-offset: 5;
}
way[obstacle="mud"] {
    right-casing-color: #50d6eb;
    right-casing-dashes: 3, 7;
    right-casing-offset: 5;
}

/* MTB scale styles with user toggle option */
setting::mtb_scale_display {
default: true;
type: boolean;
label: "Display MTB Difficulty Scale";
description: "Toggle display of MTB Difficulty Scale";
}

way[mtb:scale][setting("mtb_scale_display")] {
casing-color: eval(
tag("mtb:scale") == "0-" ? "#50d6eb" :
tag("mtb:scale") == "0" ? "#75e009" :
tag("mtb:scale") == "1" ? "#e3e800" :
tag("mtb:scale") == "2" ? "#feb13e" :
tag("mtb:scale") == "3" ? "#ff4454" :
tag("mtb:scale") == "4" ? "#f20bab" :
tag("mtb:scale") == "5" ? "#bf1cf5" :
tag("mtb:scale") == "6" ? "#8100ac" : "#ffffff"
);
dashes-background-color: eval(
tag("mtb:scale") == "0-" ? "#50d6eb" :
tag("mtb:scale") == "0" ? "#75e009" :
tag("mtb:scale") == "1" ? "#e3e800" :
tag("mtb:scale") == "2" ? "#feb13e" :
tag("mtb:scale") == "3" ? "#ff4454" :
tag("mtb:scale") == "4" ? "#f20bab" :
tag("mtb:scale") == "5" ? "#bf1cf5" :
tag("mtb:scale") == "6" ? "#8100ac" : "#ffffff"
);
}

/* MTB uphill scale styles with user toggle option */
setting::mtb_uphill_display {
default: true;
type: boolean;
label: "Display MTB Uphill Difficulty Scale";
description: "Toggle display of MTB Uphill Difficulty Scale";
}

way[mtb:scale:uphill][setting("mtb_uphill_display")] {
left-casing-dashes: 3, 15;
left-casing-dashes-background-opacity: 0.25;
left-casing-color: eval(
tag("mtb:scale:uphill") == "1" ? "#e3e800" :
tag("mtb:scale:uphill") == "2" ? "#feb13e" :
tag("mtb:scale:uphill") == "3" ? "#ff4454" :
tag("mtb:scale:uphill") == "4" ? "#f20bab" :
tag("mtb:scale:uphill") == "5" ? "#bf1cf5" : "#ffffff"
);
left-casing-dashes-background-color: eval(
tag("mtb:scale:uphill") == "1" ? "#e3e800" :
tag("mtb:scale:uphill") == "2" ? "#feb13e" :
tag("mtb:scale:uphill") == "3" ? "#ff4454" :
tag("mtb:scale:uphill") == "4" ? "#f20bab" :
tag("mtb:scale:uphill") == "5" ? "#bf1cf5" : "#ffffff"
);
}

/* Indicates no bicycle access or restricted access (no, private, permissive) for tracks and paths */
way[highway=~/track|path/][bicycle=permissive]::core_access,
way[highway=~/track|path/][access=permissive]::core_access {
    z-index: -1;
    width: 10;
    color: #ff0000;
    dashes: 2, 15;
}
way[highway=~/track|path/][bicycle=no]::core_access,
way[highway=~/track|path/][bicycle=private]::core_access,
way[highway=~/track|path/][access=no]::core_access,
way[highway=~/track|path/][access=private]::core_access {
    z-index: -1;
    width: 10;
    color: #ff0000;
    dashes: 4, 4;
}
